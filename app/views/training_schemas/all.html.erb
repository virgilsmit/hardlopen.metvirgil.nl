<h1 class="page-title">Alle trainingen</h1>
<% if @schema_name.present? %>
  <p class="schema-subtitle">Schema: <strong><%= @schema_name %></strong></p>
<% elsif @upcoming_sessions.empty? && @past_sessions.empty? %>
  <div class="alert alert-info" style="padding: 1rem; background: #e3f2fd; border-left: 4px solid #2196f3; margin: 1rem 0;">
    <p><strong>Geen trainingsschema ingesteld</strong></p>
    <p>Je hebt nog geen persoonlijk trainingsschema gekozen. Ga naar je <a href="<%= profile_path %>">profiel</a> om een standaard schema te selecteren.</p>
  </div>
<% end %>

<% if @upcoming_sessions.any? || @past_sessions.any? %>
<div class="tab-container">
  <button id="tab-upcoming" class="tab-btn active" onclick="showTab('upcoming')">Komende trainingen</button>
  <button id="tab-past" class="tab-btn" onclick="showTab('past')">Afgelopen trainingen</button>
</div>

<!-- Komende trainingen -->
<div id="tab-upcoming-content">
  <h2 class="section-title">Komende trainingen</h2>
  <% if @upcoming_sessions.any? %>
  <div class="training-cards-grid">
    <% @upcoming_sessions.each do |sessie| %>
      <% attendance = current_user ? sessie.attendances.find_by(user_id: current_user.id) : nil %>
      <div class="training-card" onclick="window.location='/training_sessions/<%= sessie.id %>'" style="cursor: pointer;">
        <!-- Header -->
        <div class="training-card-header">
          <div>
            <div class="training-card-date">
              <%= l(sessie.date, format: '%A %d %B %Y') %>
            </div>
            <div class="training-card-phase"><%= sessie.fase %></div>
          </div>
          <div class="training-card-status">
            <% if attendance&.status == 'aanwezig' %>
              <span class="status-badge status-aanwezig">‚úì Aanwezig</span>
            <% elsif attendance&.status == 'afwezig' %>
              <span class="status-badge status-afwezig">‚úó Afwezig</span>
            <% else %>
              <span class="status-badge status-onbekend">‚ö™ Geen status</span>
            <% end %>
          </div>
        </div>
        
        <!-- Body -->
        <div class="training-card-body">
          <h3 class="training-card-title"><%= sessie.description %></h3>
          <div class="training-card-details">
            <div class="training-detail-item">
              <span class="detail-label">üèÉ Loopscholing:</span>
              <span class="detail-value"><%= sessie.loopscholing || '-' %></span>
            </div>
            <div class="training-detail-item">
              <span class="detail-label">üë§ Trainer:</span>
              <span class="detail-value">
                <% if current_user&.has_role?(:trainer) %>
                  <%= form_with model: sessie, url: training_session_path(sessie), method: :patch, local: true, style: 'display: inline-flex; gap: 4px; align-items: center;', onclick: 'event.stopPropagation();' do |f| %>
                    <%= f.collection_select :trainer_id, User.with_role(:trainer), :id, :name, { include_blank: '(geen)', selected: sessie.trainer_id }, { style: 'padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.9rem;' } %>
                    <%= f.submit '‚úì', style: 'padding: 4px 8px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;' %>
                  <% end %>
                <% else %>
                  <%= sessie.trainer&.name || '-' %>
                <% end %>
              </span>
            </div>
            <div class="training-detail-item">
              <span class="detail-label">üìç Locatie:</span>
              <span class="detail-value"><%= sessie.locatie || '-' %></span>
            </div>
            <% if sessie.wedstrijd.present? %>
              <div class="training-detail-item">
                <span class="detail-label">üèÜ Wedstrijd:</span>
                <span class="detail-value"><%= sessie.wedstrijd %></span>
              </div>
            <% end %>
            <% if attendance&.status == 'afwezig' && attendance.note.present? %>
              <div class="training-detail-item">
                <span class="detail-label">üìù Notitie:</span>
                <span class="detail-value"><%= attendance.note %></span>
              </div>
            <% end %>
          </div>
        </div>
        
        <!-- Footer met acties -->
        <div class="training-card-footer" onclick="event.stopPropagation();">
          <% if current_user %>
            <div class="training-card-actions">
              <%= form_with url: attendances_path, method: :post, local: true, style: 'display: inline;' do |f| %>
                <%= f.hidden_field :user_id, value: current_user.id %>
                <%= f.hidden_field :training_session_id, value: sessie.id %>
                <%= f.hidden_field :status, value: 'aanwezig' %>
                <button type="submit" class="action-btn action-btn-aanwezig <%= (attendance.nil? || attendance.status == 'aanwezig') ? 'active' : '' %>">
                  ‚úì Aanwezig
                </button>
              <% end %>
              
              <%= form_with url: attendances_path, method: :post, local: true, style: 'display: inline;' do |f| %>
                <%= f.hidden_field :user_id, value: current_user.id %>
                <%= f.hidden_field :training_session_id, value: sessie.id %>
                <%= f.hidden_field :status, value: 'afwezig' %>
                <button type="submit" class="action-btn action-btn-afwezig <%= attendance&.status == 'afwezig' ? 'active' : '' %>">
                  ‚úó Afwezig
                </button>
                <% if attendance&.status == 'afwezig' %>
                  <%= f.text_field :note, value: attendance.note, placeholder: 'Notitie (optioneel)', style: 'margin-left: 8px; padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.9rem; width: 200px;' %>
                <% end %>
              <% end %>
            </div>
            
            <% if current_user.admin? || (current_user.has_role?(:trainer) && (sessie.group&.hoofdtrainer_id == current_user.id || sessie.group&.medetrainer_id == current_user.id)) %>
              <%= link_to '‚úèÔ∏è Bewerken', edit_training_session_path(sessie), class: 'action-btn action-btn-edit' %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  <% else %>
    <p>Geen komende trainingen.</p>
  <% end %>
</div>

<!-- Afgelopen trainingen -->
<div id="tab-past-content" style="display:none;">
  <h2 class="section-title">Afgelopen trainingen</h2>
  <% if @past_sessions.any? %>
  <div class="training-cards-grid">
    <% @past_sessions.each do |sessie| %>
      <% attendance = current_user ? sessie.attendances.find_by(user_id: current_user.id) : nil %>
      <div class="training-card" onclick="window.location='/training_sessions/<%= sessie.id %>'" style="cursor: pointer; opacity: 0.85;">
        <div class="training-card-header">
          <div>
            <div class="training-card-date">
              <%= l(sessie.date, format: '%A %d %B %Y') %>
            </div>
            <div class="training-card-phase"><%= sessie.fase %></div>
          </div>
          <div class="training-card-status">
            <% if attendance&.status == 'aanwezig' %>
              <span class="status-badge status-aanwezig">‚úì Aanwezig</span>
            <% elsif attendance&.status == 'afwezig' %>
              <span class="status-badge status-afwezig">‚úó Afwezig</span>
            <% else %>
              <span class="status-badge status-onbekend">‚ö™ Geen status</span>
            <% end %>
          </div>
        </div>
        
        <div class="training-card-body">
          <h3 class="training-card-title"><%= sessie.description %></h3>
          <div class="training-card-details">
            <div class="training-detail-item">
              <span class="detail-label">üèÉ Loopscholing:</span>
              <span class="detail-value"><%= sessie.loopscholing || '-' %></span>
            </div>
            <div class="training-detail-item">
              <span class="detail-label">üë§ Trainer:</span>
              <span class="detail-value"><%= sessie.trainer&.name || '-' %></span>
            </div>
            <div class="training-detail-item">
              <span class="detail-label">üìç Locatie:</span>
              <span class="detail-value"><%= sessie.locatie || '-' %></span>
            </div>
            <% if sessie.wedstrijd.present? %>
              <div class="training-detail-item">
                <span class="detail-label">üèÜ Wedstrijd:</span>
                <span class="detail-value"><%= sessie.wedstrijd %></span>
              </div>
            <% end %>
            <% if attendance&.note.present? %>
              <div class="training-detail-item">
                <span class="detail-label">üìù Notitie:</span>
                <span class="detail-value"><%= attendance.note %></span>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  <% else %>
    <p>Geen afgelopen trainingen.</p>
  <% end %>
</div>
<% end %>

<style>
/* Training cards grid */
.training-cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
  gap: 1.5rem;
  margin: 1.5rem 0;
}

@media (max-width: 768px) {
  .training-cards-grid {
    grid-template-columns: 1fr;
  }
}

/* Training card */
.training-card {
  background: #ffffff;
  border: 2px solid #e5e7eb;
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.training-card:hover {
  border-color: #FC4C02;
  box-shadow: 0 8px 24px rgba(252, 76, 2, 0.15);
  transform: translateY(-2px);
}

/* Card header */
.training-card-header {
  background: linear-gradient(135deg, #FC4C02 0%, #FF6B35 100%);
  padding: 1.25rem;
  display: flex;
  justify-content: space-between;
  align-items: start;
  gap: 1rem;
}

.training-card-date {
  color: #ffffff;
  font-weight: 700;
  font-size: 1.15rem;
  margin-bottom: 0.25rem;
  text-transform: capitalize;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.training-card-phase {
  color: #ffffff;
  font-size: 0.9rem;
  font-weight: 600;
  opacity: 0.9;
}

.training-card-status {
  flex-shrink: 0;
}

/* Status badges */
.status-badge {
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-weight: 700;
  font-size: 0.95rem;
  white-space: nowrap;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.status-badge.status-aanwezig {
  background: #10b981;
  color: #ffffff;
  border-color: rgba(255, 255, 255, 0.4);
}

.status-badge.status-afwezig {
  background: #ef4444;
  color: #ffffff;
  border-color: rgba(255, 255, 255, 0.4);
}

.status-badge.status-onbekend {
  background: rgba(255, 255, 255, 0.2);
  color: #ffffff;
  border-color: rgba(255, 255, 255, 0.4);
}

/* Card body */
.training-card-body {
  padding: 1.25rem;
}

.training-card-title {
  color: #0a0a0a;
  font-size: 1.2rem;
  font-weight: 800;
  margin: 0 0 1rem 0;
  line-height: 1.4;
}

.training-card-details {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.training-detail-item {
  display: flex;
  gap: 0.5rem;
  align-items: start;
}

.detail-label {
  color: #4b5563;
  font-weight: 700;
  font-size: 0.95rem;
  min-width: 130px;
  flex-shrink: 0;
}

.detail-value {
  color: #0a0a0a;
  font-size: 0.95rem;
  font-weight: 500;
  flex: 1;
}

/* Card footer */
.training-card-footer {
  padding: 1rem 1.25rem;
  background: #f9fafb;
  border-top: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.training-card-actions {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
}

/* Action buttons */
.action-btn {
  padding: 0.75rem 1.5rem;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.2s ease;
  background: #ffffff;
  color: #1a2332;
  text-decoration: none;
  display: inline-block;
}

.action-btn-aanwezig {
  border-color: #10b981;
  color: #10b981;
}

.action-btn-aanwezig.active {
  background: #10b981;
  color: #ffffff;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.action-btn-afwezig {
  border-color: #ef4444;
  color: #ef4444;
}

.action-btn-afwezig.active {
  background: #ef4444;
  color: #ffffff;
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.action-btn-edit {
  border-color: #FC4C02;
  color: #FC4C02;
  padding: 0.75rem 1rem;
}

.action-btn-edit:hover {
  background: #FC4C02;
  color: #ffffff;
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
</style>

<script>
  function showTab(tab) {
    document.getElementById('tab-upcoming-content').style.display = (tab === 'upcoming') ? '' : 'none';
    document.getElementById('tab-past-content').style.display = (tab === 'past') ? '' : 'none';
    document.getElementById('tab-upcoming').classList.toggle('active', tab === 'upcoming');
    document.getElementById('tab-past').classList.toggle('active', tab === 'past');
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    showTab('upcoming');
  });
</script>
