<%= form_with(model: user, html: { class: 'users-form' }) do |form| %>
  <% if user.errors.any? %>
    <div class="app-card" style="background: #f8d7da; border-color: #f5c6cb; color: #721c24;">
      <h2><%= pluralize(user.errors.count, "fout") %> verhinderde dat deze loper werd opgeslagen:</h2>

      <ul>
        <% user.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="app-form-group">
    <%= form.label :name, "Naam", class: "app-form-label" %>
    <%= form.text_field :name, class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :email, "E-mailadres", class: "app-form-label" %>
    <%= form.text_field :email, class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :status_id, "Status", class: "app-form-label" %>
    <%= form.collection_select :status_id, Status.all, :id, :name, { prompt: 'Kies status' }, { class: "app-form-input" } %>
  </div>

  <div class="app-form-group">
    <%= form.label :phone, "Telefoonnummer", class: "app-form-label" %>
    <%= form.text_field :phone, class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :emergency_contact, "Noodcontact", class: "app-form-label" %>
    <%= form.text_field :emergency_contact, class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :birthday, "Geboortedatum", class: "app-form-label" %>
    <%= form.date_field :birthday, class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :injury, "Blessure(s)", class: "app-form-label" %>
    <%= form.text_area :injury, class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :photo_permission, "Toestemming voor foto's", class: "app-form-label" %>
    <%= form.check_box :photo_permission %>
  </div>

  <div class="app-form-group">
    <%= form.label :roles, "Rollen", class: "app-form-label" %>
    <div class="roles-checkboxes">
      <%= hidden_field_tag 'user[roles][]', '' %>
      <% User.roles.keys.each do |role_key| %>
        <label class="roles-checkboxes__item">
          <%= check_box_tag 'user[roles][]', role_key, (user.roles || []).include?(role_key), id: "user_roles_#{role_key}" %>
          <span><%= role_key.titleize %></span>
        </label>
      <% end %>
    </div>
  </div>

  <% if current_user&.admin? %>
    <div class="app-form-group">
      <%= form.label :default_training_schema_id, "Standaard schema", class: "app-form-label" %>
      <%= form.collection_select :default_training_schema_id, TrainingSchema.order(:name), :id, :name, { include_blank: 'Geen schema' }, { class: "app-form-input" } %>
    </div>
  <% end %>

  <div class="app-form-group">
    <%= form.label :password, "Wachtwoord", class: "app-form-label" %>
    <%= form.password_field :password, autocomplete: "new-password", class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :password_confirmation, "Bevestig wachtwoord", class: "app-form-label" %>
    <%= form.password_field :password_confirmation, autocomplete: "new-password", class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <%= form.label :csv_name, "CSV-naam (voor koppeling met historie)", class: "app-form-label" %>
    <%= form.text_field :csv_name, class: "app-form-input" %>
  </div>

  <div class="app-form-group">
    <label class="app-form-label">Trainingsdagen</label>
    <div style="margin-top: 0.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem;">
      <% %w[Maandag Dinsdag Woensdag Donderdag Vrijdag Zaterdag Zondag].each do |day| %>
        <label style="display: flex; align-items: center; gap: 0.5rem;">
          <%= check_box_tag 'user[training_days][]', day, user.training_days.present? ? user.training_days.include?(day) : false %>
          <span><%= day %></span>
        </label>
      <% end %>
    </div>
  </div>

  <div class="app-form-group">
    <%= form.submit "Opslaan", class: "app-btn" %>
  </div>
<% end %>
