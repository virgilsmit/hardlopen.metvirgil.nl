<div class="zones-page surface-dark">
  <h1 class="page-heading">Hartslagzones & drempel ‚Äì <%= @runner.name %></h1>

  <% if @lt_heart_rate.nil? && @lt_pace_seconds.nil? %>
    <div class="card-surface alert-card">
      <p><strong>Nog geen gegevens bekend.</strong></p>
      <p>Voeg hieronder een prestatie toe met 'Gemiddelde hartslag kern (bpm)' om zones en prognoses te zien.</p>
    </div>
  <% else %>
    <!-- Anaerobe drempel -->
    <div class="card-surface">
      <h2>Anaerobe drempel</h2>
      <div class="threshold-info">
        <% if @lt_heart_rate %>
          <div class="threshold-item">
            <strong>Hartslag (LT-HR):</strong>
            <span class="threshold-value"><%= @lt_heart_rate %> bpm</span>
          </div>
        <% end %>
        <% if @lt_pace_human %>
          <div class="threshold-item">
            <strong>Tempo (LT-pace):</strong>
            <span class="threshold-value"><%= @lt_pace_human %>/km</span>
          </div>
        <% end %>
        <% if @reference_performance %>
          <div class="threshold-item">
            <strong>Referentieprestatie:</strong>
            <span class="threshold-value">
              <%= @reference_performance.date&.strftime('%d-%m-%Y') %> 
              (<%= @reference_performance.distance.to_i / 1000.0 %> km)
            </span>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Hartslagzones -->
    <% if @heart_rate_zones %>
      <div class="card-surface">
        <h2>Hartslagzones</h2>
        <div class="zones-grid">
          <% @heart_rate_zones.each_with_index do |(key, zone), index| %>
            <div class="zone-card zone-<%= key.to_s.gsub('z', '') %>">
              <div class="zone-header">
                <strong><%= zone[:name] %></strong>
              </div>
              <div class="zone-range">
                <% if zone[:min].nil? %>
                  <span>&lt; <%= zone[:max] %> bpm</span>
                <% elsif zone[:max].nil? %>
                  <span>&gt; <%= zone[:min] %> bpm</span>
                <% else %>
                  <span><%= zone[:min] %> - <%= zone[:max] %> bpm</span>
                <% end %>
              </div>
              <div class="zone-description">
                <% case index %>
                <% when 0 %>
                  <p>Inlopen, uitlopen, herstel, techniek</p>
                <% when 1 %>
                  <p>Duurloop, lange duurloop</p>
                <% when 2 %>
                  <p>Duurloop met tempoblokken</p>
                <% when 3 %>
                  <p>Extensief interval (lange blokken)</p>
                <% when 4 %>
                  <p>Intensief interval (korte blokken)</p>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Tempozones -->
    <% if @pace_zones %>
      <div class="card-surface">
        <h2>Tempozones</h2>
        <div class="zones-grid">
          <% @pace_zones.each_with_index do |(key, zone), index| %>
            <div class="zone-card zone-<%= key.to_s.gsub('z', '') %>">
              <div class="zone-header">
                <strong><%= zone[:name] %></strong>
              </div>
              <div class="zone-range">
                <% if zone[:min_sec].nil? && zone[:max_sec] %>
                  <span>langzamer dan <%= zone[:max_human] %></span>
                <% elsif zone[:max_sec].nil? && zone[:min_sec] %>
                  <span>sneller dan <%= zone[:min_human] %></span>
                <% elsif zone[:min_sec] && zone[:max_sec] %>
                  <span><%= zone[:max_human] %> - <%= zone[:min_human] %></span>
                <% else %>
                  <span>-</span>
                <% end %>
              </div>
              <div class="zone-description">
                <% case index %>
                <% when 0 %>
                  <p>Inlopen, uitlopen, herstel, techniek</p>
                <% when 1 %>
                  <p>Duurloop, lange duurloop</p>
                <% when 2 %>
                  <p>Duurloop met tempoblokken</p>
                <% when 3 %>
                  <p>Extensief interval (lange blokken)</p>
                <% when 4 %>
                  <p>Intensief interval (korte blokken)</p>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Prognoses -->
    <% if @race_predictions %>
      <div class="card-surface">
        <h2>Prognose wedstrijdtijden</h2>
        <div class="predictions-grid">
          <% @race_predictions.each do |distance, prediction| %>
            <div class="prediction-card">
              <div class="prediction-distance">
                <strong>
                  <%= case distance
                      when "5k" then "5 km"
                      when "10k" then "10 km"
                      when "15k" then "15 km"
                      when "hm" then "Halve marathon"
                      else distance
                      end %>
                </strong>
              </div>
              <div class="prediction-time">
                <%= prediction[:human] %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>

  <!-- Recente prestaties met hartslag -->
  <% if @recent_performances.any? %>
    <div class="card-surface">
      <h2>Recente prestaties met hartslag</h2>
      <p style="color: #9ca3af; font-size: 0.9rem; margin-bottom: 1rem;">Klik op een prestatie om de volledige statistieken te bekijken</p>
      <div class="performances-table-wrapper">
        <table class="schema-table performances-table">
          <thead>
            <tr>
              <th>Datum</th>
              <th>Onderdeel</th>
              <th>Afstand</th>
              <th>Tijd</th>
              <th>Gem. Hartslag</th>
              <th>km/min</th>
              <th>Notities</th>
              <% if current_user&.admin? || current_user&.id == @runner.id %>
<th>Acties</th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% @recent_performances.each do |perf| %>
              <tr class="performance-row clickable-row" data-performance-id="<%= perf.id %>">
                <td data-label="Datum"><%= perf.date&.strftime('%d-%m-%Y') %></td>
                <td data-label="Onderdeel"><%= perf.test_type %></td>
                <td data-label="Afstand"><%= perf.distance %></td>
                <td data-label="Tijd"><%= perf.value %></td>
                <td data-label="Gem. Hartslag"><%= perf.core_heart_rate ? "#{perf.core_heart_rate} bpm" : '-' %></td>
                <td data-label="km/min"><%= km_min(perf) %></td>
                <td data-label="Notities"><%= perf.notes %></td>
                <% if current_user&.admin? || current_user&.id == @runner.id %>
                  <td data-label="Acties" class="performance-actions" onclick="event.stopPropagation();">
                    <%= link_to '‚úèÔ∏è', edit_performance_path(perf), class: 'theme-btn track-btn--outline', style: 'padding: 0.5rem 1rem; font-size: 1rem;' %>
                    <%= button_to 'üóëÔ∏è', performance_path(perf), method: :delete, data: { confirm: 'Weet je zeker dat je deze prestatie wilt verwijderen?' }, class: 'theme-btn track-btn--outline danger-btn', style: 'padding: 0.5rem 1rem; font-size: 1rem; background: #ef4444; color: white; border: none;' %>
                  </td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <!-- Nieuwe prestatie toevoegen -->
  <div class="card-surface">
    <h2>Nieuwe prestatie toevoegen</h2>
    <%= render 'performances/form', performance: @performance %>
  </div>

  <!-- Uitleg Tempozones -->
  <% if @pace_zones %>
    <div class="card-surface">
      <h2>Uitleg Zones & Begrippen</h2>
      
      <!-- Uitleg LT-HR en LT-pace -->
      <div class="zone-explanation" style="margin-bottom: 2rem;">
        <div class="zone-explanation-item" style="border-left-color: #FC4C02;">
          <h3>üíì LT-HR (Lactate Threshold Heart Rate)</h3>
          <p><strong>Betekenis:</strong> Hartslag bij de anaerobe drempel</p>
          <p>Dit is de <strong>hartslag</strong> waarbij je lichaam begint over te schakelen van voornamelijk a√´robe (met zuurstof) naar ana√´robe (zonder zuurstof) energievoorziening. Op dit punt begint lactaat (melkzuur) zich sneller op te bouwen dan je lichaam het kan afbreken.</p>
          <p><strong>Waarom belangrijk:</strong></p>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li>Dit is een <strong>cruciaal punt</strong> voor hardlopers</li>
            <li>Je kunt hier nog relatief lang volhouden (30-60 minuten)</li>
            <li>Het is een goede indicator van je fitheid</li>
            <li>Alle hartslagzones worden hiervan afgeleid</li>
          </ul>
          <p><strong>Voorbeeld:</strong> Als je LT-HR 170 bpm is, dan is 170 slagen per minuut je drempelhartslag.</p>
        </div>

        <div class="zone-explanation-item" style="border-left-color: #FC4C02;">
          <h3>üèÉ LT-pace (Lactate Threshold Pace)</h3>
          <p><strong>Betekenis:</strong> Tempo bij de anaerobe drempel</p>
          <p>Dit is het <strong>tempo per kilometer</strong> dat je kunt lopen bij je anaerobe drempel. Ook wel <strong>drempeltempo</strong> of <strong>threshold pace</strong> genoemd.</p>
          <p><strong>Kenmerken:</strong></p>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li>Dit tempo kun je ongeveer <strong>30-60 minuten</strong> volhouden in een race</li>
            <li>Vergelijkbaar met je <strong>10km race tempo</strong></li>
            <li>Iets langzamer dan 10km, iets sneller dan halve marathon</li>
            <li>Alle tempozones worden hiervan afgeleid</li>
          </ul>
          <p><strong>Voorbeeld:</strong> Als je LT-pace 5:00 min/km is, dan kun je ongeveer een uur lang 5:00 per kilometer lopen.</p>
        </div>

        <div class="zone-explanation-item" style="border-left-color: #1ee3cf;">
          <h3>üéØ Hoe worden ze bepaald?</h3>
          <p>In dit systeem worden LT-HR en LT-pace berekend op basis van:</p>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li><strong>Prestaties met hartslag</strong> - Een 10km test of vergelijkbare prestatie</li>
            <li><strong>Core heart rate</strong> - Gemiddelde hartslag tijdens de kern van de training</li>
            <li><strong>Tijd en afstand</strong> - Om het tempo te berekenen</li>
          </ul>
          <p style="margin-top: 1rem; padding: 1rem; background: rgba(30, 227, 207, 0.1); border-radius: 8px;">
            üí° <strong>Tip:</strong> Dit is de basis van de <strong>ASM-methodiek</strong>! Door te trainen rond je drempel verbeter je je uithoudingsvermogen het meest effectief.
          </p>
        </div>
      </div>

      <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: #1ee3cf;">Tempozones uitleg</h3>
      
      <div class="zone-explanation">
        <div class="zone-explanation-item">
          <h3>Zone 1 ‚Äî Herstel</h3>
          <p><strong>Intensiteit:</strong> &lt; 85% van anaerobe drempel</p>
          <p><strong>Gebruik voor:</strong> inlopen, uitlopen, hersteltrainingen, techniek.</p>
          <p><strong>Gevoel:</strong> Ontspannen, je kunt makkelijk praten.</p>
          <p><strong>Duur:</strong> 1-9 uur mogelijk</p>
          <p><strong>Trainingseffect:</strong> Verhoging van bloedcirculatie en temperatuur van werkende spieren.</p>
        </div>

        <div class="zone-explanation-item">
          <h3>Zone 2 ‚Äî Extensieve duur</h3>
          <p><strong>Intensiteit:</strong> 85-93% van anaerobe drempel</p>
          <p><strong>Gebruik voor:</strong> duurloop, lange duurloop.</p>
          <p><strong>Gevoel:</strong> Comfortabel, je loopt relaxed maar wel duidelijk hard.</p>
          <p><strong>Duur:</strong> 1-3 uur mogelijk</p>
          <p><strong>Trainingseffect:</strong> Verbetering van aerobe metabolische effici√´ntie.</p>
          <p style="margin-top: 0.5rem; padding: 0.75rem; background: rgba(30, 227, 207, 0.1); border-radius: 6px; font-size: 0.9rem;">
            üí° Het grootste deel van je trainingsvolume moet in deze zone zijn.
          </p>
        </div>

        <div class="zone-explanation-item">
          <h3>Zone 3 ‚Äî Intensieve duur</h3>
          <p><strong>Intensiteit:</strong> 93-100% van anaerobe drempel (rond de drempel)</p>
          <p><strong>Gebruik voor:</strong> duurloop met langere tempoblokken.</p>
          <p><strong>Gevoel:</strong> "Comfortabel hard", je kunt nog praten maar in korte zinnen.</p>
          <p><strong>Duur:</strong> 45-90 min mogelijk</p>
          <p><strong>Trainingseffect:</strong> Verbetering van overgang van aerobe naar anaerobe energiesysteem.</p>
        </div>

        <div class="zone-explanation-item">
          <h3>Zone 4 ‚Äî Extensief interval</h3>
          <p><strong>Intensiteit:</strong> 100-103% van anaerobe drempel (net boven drempel)</p>
          <p><strong>Gebruik voor:</strong> extensief interval = langere blokken (bijv. 4x 1000m) met weinig rust.</p>
          <p><strong>Gevoel:</strong> Pittig maar houdbaar, rond je 10km wedstrijdtempo.</p>
          <p><strong>Duur:</strong> 30-60 min mogelijk</p>
          <p><strong>Trainingseffect:</strong> Verbetering van anaerobe metabolische effici√´ntie.</p>
        </div>

        <div class="zone-explanation-item">
          <h3>Zone 5 ‚Äî Intensief interval</h3>
          <p><strong>Intensiteit:</strong> &gt; 103% van anaerobe drempel (ruim boven drempel)</p>
          <p><strong>Gebruik voor:</strong> intensief interval = kortere blokken (bijv. 8x 400m) op hoge snelheid.</p>
          <p><strong>Gevoel:</strong> Zwaar en intens, dit houd je maar kort vol.</p>
          <p><strong>Duur:</strong> 15-30 min mogelijk</p>
          <p><strong>Trainingseffect:</strong> Verbetering van lactaattolerantie en VO2max.</p>
        </div>
      </div>

      <div class="training-overview">
        <h3>Overzicht Trainingsvorm per Zone</h3>
        <ul class="training-list">
          <li>Warming-up ‚Üí Zone 1</li>
          <li>Cooling-down ‚Üí Zone 1</li>
          <li>Extensieve duurloop ‚Üí Zone 2</li>
          <li>Lange rustige duurloop ‚Üí Zone 2</li>
          <li>Vetverbrandingsduurloop ‚Üí Zone 2</li>
          <li>Stevige duurloop ‚Üí Zone 3</li>
          <li>Extensieve interval ‚Üí Zone 3</li>
          <li>Tempoblokken ‚Üí Zone 3 of Zone 4</li>
          <li>Drempeltraining ‚Üí Zone 4</li>
          <li>Korte interval/sprints ‚Üí Zone 5</li>
          <li>Heuveltraining ‚Üí Zone 5</li>
        </ul>
      </div>
    </div>
  <% end %>
</div>

<style>
  .zones-page {
    padding: 2rem 1.5rem;
  }

  .threshold-info {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }

  .threshold-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
  }

  .threshold-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1ee3cf;
  }

  .zones-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .zone-card {
    padding: 1.25rem;
    border-radius: 12px;
    border: 2px solid rgba(255, 255, 255, 0.15);
    background: rgba(255, 255, 255, 0.05);
    transition: all 0.2s ease;
  }

  .zone-card:hover {
    border-color: rgba(252, 76, 2, 0.4);
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(252, 76, 2, 0.2);
  }

  .zone-header {
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .zone-header strong {
    font-size: 1.1rem;
    color: #1ee3cf;
    display: block;
  }

  .zone-range {
    font-size: 1.05rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 0.75rem;
  }

  .zone-description {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
  }

  .zone-description p {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
    margin: 0;
  }

  /* Specifieke kleuren per zone */
  .zone-card.zone-1 {
    border-left: 4px solid #60a5fa;
  }

  .zone-card.zone-2 {
    border-left: 4px solid #34d399;
  }

  .zone-card.zone-3 {
    border-left: 4px solid #fbbf24;
  }

  .zone-card.zone-4 {
    border-left: 4px solid #fb923c;
  }

  .zone-card.zone-5 {
    border-left: 4px solid #f87171;
  }

  /* Klikbare prestatie rijen */
  .performances-table tbody tr.performance-row {
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
  }

  .performances-table tbody tr.performance-row:hover {
    background: rgba(252, 76, 2, 0.1) !important;
    transform: translateX(4px);
    box-shadow: 0 4px 12px rgba(252, 76, 2, 0.15);
  }

  .performances-table tbody tr.performance-row:active {
    background: rgba(252, 76, 2, 0.15) !important;
    transform: translateX(2px);
  }

  /* Visual indicator voor klikbare rij */
  .performances-table tbody tr.performance-row::after {
    content: 'üëÅÔ∏è Bekijk';
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0;
    font-size: 0.85rem;
    color: #FC4C02;
    font-weight: 600;
    transition: opacity 0.2s ease;
    pointer-events: none;
  }

  .performances-table tbody tr.performance-row:hover::after {
    opacity: 1;
  }

  /* Performance actions buttons */
  .performance-actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .performance-actions .theme-btn {
    pointer-events: auto !important;
    z-index: 10 !important;
  }

  .danger-btn {
    background: #ef4444 !important;
    color: white !important;
    border: none !important;
  }

  .danger-btn:hover {
    background: #dc2626 !important;
  }

  .zone-header {
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    color: rgba(244, 248, 255, 0.8);
  }

  .zone-range {
    font-size: 1rem;
    font-weight: 600;
    color: #f4f8ff;
  }

  .zone-1 { border-left: 4px solid #4caf50; }
  .zone-2 { border-left: 4px solid #8bc34a; }
  .zone-3 { border-left: 4px solid #ffc107; }
  .zone-4 { border-left: 4px solid #ff9800; }
  .zone-5 { border-left: 4px solid #f44336; }

  .predictions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .prediction-card {
    padding: 1.25rem;
    border-radius: 12px;
    background: rgba(30, 227, 207, 0.1);
    border: 1px solid rgba(30, 227, 207, 0.3);
    text-align: center;
  }

  .prediction-distance {
    font-size: 0.9rem;
    color: rgba(244, 248, 255, 0.8);
    margin-bottom: 0.5rem;
  }

  .prediction-time {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1ee3cf;
  }

  .performances-table-wrapper {
    margin-top: 1rem;
    overflow-x: auto;
  }

  .zone-explanation {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .zone-explanation-item {
    padding: 1.25rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border-left: 4px solid rgba(30, 227, 207, 0.4);
  }

  .zone-explanation-item h3 {
    color: #1ee3cf;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 0.75rem 0;
  }

  .zone-explanation-item p {
    margin: 0.5rem 0;
    line-height: 1.6;
    color: rgba(244, 248, 255, 0.9);
  }

  .zone-explanation-item strong {
    color: #f4f8ff;
    font-weight: 600;
  }

  .training-overview {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .training-overview h3 {
    color: #1ee3cf;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
  }

  .training-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.75rem;
  }

  .training-list li {
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    color: rgba(244, 248, 255, 0.85);
    font-size: 0.95rem;
  }

  @media (max-width: 768px) {
    .zones-grid,
    .predictions-grid {
      grid-template-columns: 1fr;
    }

    .training-list {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  // Maak prestatie rijen klikbaar
  document.addEventListener('DOMContentLoaded', function() {
    const performanceRows = document.querySelectorAll('.performance-row');
    
    performanceRows.forEach(row => {
      row.addEventListener('click', function(e) {
        // Voorkom navigatie als er op een button of link wordt geklikt
        if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || e.target.closest('.performance-actions')) {
          return;
        }
        
        const performanceId = this.dataset.performanceId;
        if (performanceId) {
          window.location.href = `/performances/${performanceId}`;
        }
      });
    });
  });
  
  // Ook werken na Turbo navigatie
  document.addEventListener('turbo:load', function() {
    const performanceRows = document.querySelectorAll('.performance-row');
    
    performanceRows.forEach(row => {
      row.addEventListener('click', function(e) {
        if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || e.target.closest('.performance-actions')) {
          return;
        }
        
        const performanceId = this.dataset.performanceId;
        if (performanceId) {
          window.location.href = `/performances/${performanceId}`;
        }
      });
    });
  });
</script>

