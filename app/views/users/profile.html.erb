<h1>Mijn Profiel</h1>

<%= link_to 'Profiel bewerken', edit_user_path(@user), class: 'theme-btn', style: 'margin-bottom: 1.5rem; display: inline-block;' %>

<div style="max-width: 500px; margin: 0 auto; text-align: left;">
  <p><strong>Naam:</strong> <%= @user.name %></p>
  <p><strong>E-mail:</strong> <%= @user.email %></p>
  <p><strong>Rol:</strong> <%= @user.role.presence || 'hardloper' %></p>
  <p><strong>Telefoon:</strong> <%= @user.phone.presence || '-' %></p>
  <p><strong>Geboortedatum:</strong> <%= @user.birthday.present? ? @user.birthday.strftime('%d-%m-%Y') : '-' %></p>
  <p><strong>Noodcontact:</strong> <%= @user.emergency_contact.presence || '-' %></p>

  <% if @user.role == 'admin' %>
    <div style="margin-top: 1.5rem; padding: 1rem; background: #e3f2fd; border-radius: 8px;">
      <strong>Beheerder:</strong> Je hebt toegang tot alle gebruikers en instellingen.
    </div>
  <% elsif @user.role == 'trainer' %>
    <div style="margin-top: 1.5rem; padding: 1rem; background: #fff3cd; border-radius: 8px;">
      <strong>Trainer:</strong> Je kunt je eigen groepen en hardlopers beheren.
      <!-- Hier kun je later een overzicht van groepen/hardlopers tonen -->
    </div>
  <% else %>
    <div style="margin-top: 1.5rem; padding: 1rem; background: #d4edda; border-radius: 8px;">
      <strong>Hardloper:</strong> Je ziet hier je eigen profiel en trainingsinformatie.
      <!-- Hier kun je later persoonlijke trainingsdata tonen -->
    </div>
  <% end %>

  <% unless @user.role == 'user' || @user.role.blank? %>
    <h2>Mijn groepen (lid)</h2>
    <% if @user.groups.any? %>
      <ul>
        <% @user.groups.each do |group| %>
          <li>
            <strong><%= group.name %></strong>
            (<%= group.hoofdtrainer&.email ? "Hoofdtrainer: #{group.hoofdtrainer.email}" : 'Geen hoofdtrainer' %>
            <% if group.medetrainer&.email %>, Medetrainer: <%= group.medetrainer.email %><% end %>)
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>Je bent nog geen lid van een groep.</p>
    <% end %>
  <% end %>

  <% if @user.hoofdtrainer_groepen.any? %>
    <h2>Groepen waar ik hoofdtrainer ben</h2>
    <ul>
      <% @user.hoofdtrainer_groepen.each do |group| %>
        <li><strong><%= group.name %></strong></li>
      <% end %>
    </ul>
  <% end %>
  <% if @user.medetrainer_groepen.any? %>
    <h2>Groepen waar ik medetrainer ben</h2>
    <ul>
      <% @user.medetrainer_groepen.each do |group| %>
        <li><strong><%= group.name %></strong></li>
      <% end %>
    </ul>
  <% end %>
  <h2>Mijn prestaties/tijden</h2>
  <% if @user.performances.any? %>
    <table style="width:100%; margin-bottom: 1rem;">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Test</th>
          <th>Waarde</th>
          <th>Notities</th>
        </tr>
      </thead>
      <tbody>
        <% @user.performances.order(date: :desc).each do |performance| %>
          <tr>
            <td><%= performance.date %></td>
            <td><%= performance.test_type %></td>
            <td><%= performance.value %></td>
            <td><%= performance.notes %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p>Je hebt nog geen prestaties geregistreerd.</p>
  <% end %>
  <h3>Nieuwe tijd/prestatie toevoegen</h3>
  <%= render 'performances/form', performance: Performance.new(user_id: @user.id) %>
  <% historie = lopers_historie_for(@user) %>
  <% if historie.any? %>
    <div style="margin-top:2rem;">
      <% laatste = historie.sort_by { |row| Date.strptime(row[:datum], '%d-%m-%y') rescue Date.new(1900,1,1) }.last %>
      <% if laatste %>
        <div style="background:#e3f2fd; border-radius:8px; padding:1rem; margin-bottom:1rem; max-width:400px;">
          <strong>Anarobe drempel:</strong> <%= laatste[:ad] %><br>
          <strong>Duurloop 85%:</strong> <%= laatste[:dl2_85] %>
        </div>
      <% end %>
      <h2>Prestaties</h2>
      <div style="overflow-x:auto;">
        <table style="width:100%; margin-bottom: 1rem; border-collapse:collapse;">
          <thead>
            <tr style="background:#f0f4f8;">
              <th style="text-align:left; padding:8px;">Datum</th>
              <th style="text-align:left; padding:8px;">Afstand</th>
              <th style="text-align:left; padding:8px;">Tijd</th>
              <th style="text-align:left; padding:8px;">Prognose 10 km</th>
              <th style="text-align:left; padding:8px;">1000m</th>
              <th style="text-align:left; padding:8px;">km/min</th>
            </tr>
          </thead>
          <tbody>
            <% historie.sort_by { |row| Date.strptime(row[:datum], '%d-%m-%y') rescue Date.new(1900,1,1) }.reverse.each do |row| %>
              <tr>
                <td style="text-align:left; padding:8px;">
                  <% begin %>
                    <%= Date.strptime(row[:datum], '%d-%m-%y').strftime('%d-%m-%Y') %>
                  <% rescue %>
                    <%= row[:datum] %>
                  <% end %>
                </td>
                <td style="text-align:left; padding:8px;"><%= row[:afstand] %></td>
                <td style="text-align:left; padding:8px;"><%= row[:tijd] %></td>
                <td style="text-align:left; padding:8px;"><%= row[:prognose_10km] %></td>
                <td style="text-align:left; padding:8px;"><%= row[:meter_1000] %></td>
                <td style="text-align:left; padding:8px;"><%= row[:km_min] %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
</div> 