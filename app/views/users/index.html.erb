<% if notice %>
  <div class="alert-card alert-success">
    <%= notice %>
  </div>
<% end %>

<h1 class="page-heading">Lopers</h1>
<p class="section-subtitle accent-text"><strong>Actieve lopers:</strong> <%= @actieve_lopers_count %></p>

<div id="lopers" class="surface-dark">
  <!-- Desktop Table -->
  <div class="desktop-only users-table-wrapper card-surface">
    <table class="users-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Group</th>
          <th>Hoofdtrainer</th>
          <th>Medetrainer</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
          <tr>
            <td data-label="Name"><%= user.name %></td>
            <td data-label="Email"><%= user.email %></td>
            <td data-label="Group"><%= user.groups.first&.name || 'No group assigned' %></td>
            <td data-label="Hoofdtrainer"><%= user.groups.first&.hoofdtrainer&.email || 'Geen hoofdtrainer' %></td>
            <td data-label="Medetrainer"><%= user.groups.first&.medetrainer&.email || 'Geen medetrainer' %></td>
            <td data-label="Status">
              <%= form_with model: user, local: true do |f| %>
                <%= f.select :status_id, Status.all.collect { |s| [s.name, s.id] }, { include_blank: '-' }, { onchange: 'this.form.submit();', class: 'status-select' } %>
              <% end %>
            </td>
            <td data-label="Actions" class="table-actions">
              <%= link_to 'Show', profile_path(id: user.id), class: 'theme-btn track-btn--outline' %>
              <%= link_to 'Edit', edit_user_path(user), class: 'theme-btn track-btn--outline' %>
              <%= link_to 'Delete', user_path(user), method: :delete, data: { confirm: 'Are you sure?' }, class: 'theme-btn table-action-delete' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <!-- Mobile Cards -->
  <div class="mobile-only">
    <% @users.each do |user| %>
      <div class="user-card">
        <div class="user-card__header">
          <h3 class="user-card__name"><%= user.name %></h3>
          <div class="user-card__actions">
            <%= link_to 'Show', profile_path(id: user.id), class: 'theme-btn track-btn--outline' %>
            <%= link_to 'Edit', edit_user_path(user), class: 'theme-btn track-btn--outline' %>
            <%= link_to 'Delete', user_path(user), method: :delete, data: { confirm: 'Are you sure?' }, class: 'theme-btn table-action-delete' %>
          </div>
        </div>
        
        <div class="user-card__body">
          <div><strong>Email:</strong> <%= user.email %></div>
          <div><strong>Groep:</strong> <%= user.groups.first&.name || 'Geen groep' %></div>
          <div><strong>Hoofdtrainer:</strong> <%= user.groups.first&.hoofdtrainer&.email || 'Geen hoofdtrainer' %></div>
          <div><strong>Medetrainer:</strong> <%= user.groups.first&.medetrainer&.email || 'Geen medetrainer' %></div>
          <div class="user-card__status">
            <strong>Status:</strong>
            <%= form_with model: user, local: true do |f| %>
              <%= f.select :status_id, Status.all.collect { |s| [s.name, s.id] }, { include_blank: '-' }, { onchange: 'this.form.submit();', class: 'status-select' } %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<%= link_to 'New User', new_user_path, class: 'theme-btn track-btn--glow' %>

<style>
  @media (max-width: 768px) {
    .desktop-only { display: none !important; }
    .mobile-only { display: block !important; }
  }
  @media (min-width: 769px) {
    .desktop-only { display: block !important; }
    .mobile-only { display: none !important; }
  }
</style>
