<div class="container-fluid py-4 bg-dark">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-4" style="color: #ffffff !important; font-weight: 800; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">üß© Menu Beheren</h1>
      <p style="color: #c9d1d9 !important; font-size: 1.1rem; font-weight: 600;">Bepaal welke pagina's zichtbaar zijn per rol en hoe menu's worden gegroepeerd</p>
    </div>
  </div>

  <!-- Uitleg Box -->
  <div class="row mb-4">
    <div class="col-12">
      <div style="background: rgba(252, 76, 2, 0.15); border: 3px solid rgba(252, 76, 2, 0.5); border-radius: 12px; padding: 1.5rem;">
        <h4 style="color: #FC4C02 !important; margin-bottom: 1rem; font-weight: 800; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">üí° Hoe werkt het?</h4>
        <div style="color: #ffffff !important; line-height: 1.8; font-weight: 600;">
          <p style="margin-bottom: 0.75rem;"><strong style="color: #1ee3cf;">In Menu:</strong> Toon in het hoofdmenu (in een dropdown onder de groep)</p>
          <p style="margin-bottom: 0.75rem;"><strong style="color: #1ee3cf;">Menu Label:</strong> Aangepaste naam voor het menu item (leeg = standaard label)</p>
          <p style="margin-bottom: 0.75rem;"><strong style="color: #1ee3cf;">Menu Groep:</strong> Bepaalt onder welke dropdown het item verschijnt (Training, Beheer, Trainers, Admin)</p>
          <hr style="border: none; border-top: 1px solid rgba(252, 76, 2, 0.3); margin: 1rem 0;">
          <p style="margin: 0;"><strong>Tip:</strong> Vink "In Menu" uit om een item te verbergen voor een specifieke rol.</p>
        </div>
      </div>
    </div>
  </div>

  <% if flash[:notice] %>
    <div class="alert alert-success mb-4" style="background: rgba(40, 167, 69, 0.1); border: 2px solid rgba(40, 167, 69, 0.3); color: #28a745;">
      ‚úì <%= flash[:notice] %>
    </div>
  <% end %>

  <% if flash[:alert] %>
    <div class="alert alert-danger mb-4" style="background: rgba(220, 53, 69, 0.1); border: 2px solid rgba(220, 53, 69, 0.3); color: #dc3545;">
      ‚ö†Ô∏è <%= flash[:alert] %>
    </div>
  <% end %>

  <!-- Tab navigatie -->
  <div class="row mb-4">
    <div class="col-12">
      <div style="display: flex; gap: 1rem; border-bottom: 2px solid rgba(255, 255, 255, 0.1);">
        <% @roles.each_with_index do |role, index| %>
          <button 
            type="button"
            onclick="showRoleTab('<%= role %>')" 
            id="tab-<%= role %>" 
            class="role-tab-button" 
            style="padding: 1rem 2rem; background: <%= index == 0 ? 'rgba(252, 76, 2, 0.2)' : 'transparent' %>; border: none; border-bottom: 3px solid <%= index == 0 ? '#FC4C02' : 'transparent' %>; font-weight: 700; color: <%= index == 0 ? '#FC4C02' : 'rgba(244, 248, 255, 0.6)' %>; cursor: pointer; font-size: 1.1rem; transition: all 0.3s;">
            <%= role == 'user' ? 'üë§ Gebruiker' : role == 'trainer' ? 'üßë‚Äçüè´ Trainer' : 'üõ†Ô∏è Admin' %>
          </button>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Content per rol -->
  <% @roles.each_with_index do |role, index| %>
    <div id="content-<%= role %>" class="role-tab-content" style="display: <%= index == 0 ? 'block' : 'none' %>;">
      <%= form_with url: save_all_admin_tiles_path, method: :post, local: true do |f| %>
        <%= f.hidden_field :role, value: role %>
        
        <!-- Per Menu Groep -->
        <% @menu_groups.each do |group_name| %>
          <% group_tiles = @tiles_by_group[group_name] || [] %>
          <% next if group_tiles.empty? %>
          
          <div class="row mb-4">
            <div class="col-12">
              <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; overflow: hidden;">
                <!-- Groep Header -->
                <div style="background: rgba(0, 0, 0, 0.3); padding: 1.25rem; border-bottom: 2px solid rgba(252, 76, 2, 0.3); display: flex; justify-content: space-between; align-items: center;">
                  <h3 style="color: #FC4C02; margin: 0; font-weight: 700; font-size: 1.3rem;">
                    <%= case group_name
                        when 'Training' then 'üèÉ‚Äç‚ôÇÔ∏è'
                        when 'Beheer' then '‚öôÔ∏è'
                        when 'Trainers' then 'üßë‚Äçüè´'
                        when 'Admin' then 'üõ†Ô∏è'
                        when 'Menu Labels' then 'üè∑Ô∏è'
                        else 'üìã'
                        end %> <%= group_name %>
                  </h3>
                  <% if ['Training', 'Beheer', 'Trainers', 'Admin'].include?(group_name) %>
                    <small style="color: #1ee3cf; font-weight: 600; font-size: 0.9rem;">
                      üí° Tip: Pas de dropdown titel aan via "Menu Labels" sectie
                    </small>
                  <% end %>
                </div>
                
                <!-- Groep Tiles -->
                <div style="padding: 1.5rem;">
                  <table class="table table-hover" style="margin: 0; background: #000000; border: 3px solid rgba(252, 76, 2, 0.4);">
                    <thead style="background: #000000; border-bottom: 4px solid #FC4C02;">
                      <tr>
                        <th style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.15); font-weight: 800; width: 25%; color: #ffffff !important; font-size: 1rem; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);">Pagina</th>
                        <th style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.15); font-weight: 800; text-align: center; width: 10%; color: #ffffff !important; font-size: 1rem; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);">In Menu</th>
                        <th style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.15); font-weight: 800; width: 25%; color: #ffffff !important; font-size: 1rem; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);">Menu Label (optioneel)</th>
                        <th style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.15); font-weight: 800; width: 25%; color: #ffffff !important; font-size: 1rem; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);">Categorie</th>
                        <th style="padding: 1.25rem 1rem; font-weight: 800; width: 15%; color: #ffffff !important; font-size: 1rem; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);">Positie</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% group_tiles.each_with_index do |tile, tile_index| %>
                        <% assignment = @tile_assignments[[role, tile[:key]]]&.first %>
                        <% field_prefix = "tiles[#{group_name}_#{tile_index}]" %>
                        
                        <tr style="border-top: 3px solid rgba(255, 255, 255, 0.2); background: <%= tile_index.even? ? 'rgba(255, 255, 255, 0.05)' : 'rgba(255, 255, 255, 0.08)' %>;">
                          <!-- Tile Key (hidden) -->
                          <%= hidden_field_tag "#{field_prefix}[key]", tile[:key] %>
                          
                          <!-- Pagina Naam -->
                          <td style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.1);">
                            <div>
                              <strong style="color: #ffffff !important; font-size: 1rem; font-weight: 700; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);"><%= tile[:label] %></strong>
                              <div style="color: #c9d1d9 !important; font-size: 0.9rem; margin-top: 0.25rem; font-weight: 500;">
                                <%= tile[:desc] %>
                              </div>
                              <code style="background: rgba(30, 227, 207, 0.2); color: #1ee3cf !important; padding: 0.35rem 0.65rem; border-radius: 4px; font-size: 0.8rem; margin-top: 0.5rem; display: inline-block; border: 1px solid rgba(30, 227, 207, 0.4); font-weight: 700;">
                                <%= tile[:url] %>
                              </code>
                            </div>
                          </td>
                          
                          <!-- In Menu Checkbox -->
                          <td style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.1); text-align: center;">
                            <div style="display: flex; align-items: center; justify-content: center;">
                              <label class="custom-checkbox" style="position: relative; display: inline-block; cursor: pointer;">
                                <%= check_box_tag "#{field_prefix}[show_in_menu]", "1", 
                                  assignment&.show_in_menu || false,
                                  style: "width: 26px; height: 26px; cursor: pointer; accent-color: #FC4C02; border: 3px solid rgba(255, 255, 255, 0.5);",
                                  class: "menu-checkbox"
                                %>
                              </label>
                            </div>
                          </td>
                          
                          <!-- Menu Label -->
                          <td style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.1);">
                            <%= text_field_tag "#{field_prefix}[custom_menu_label]", 
                              assignment&.custom_menu_label,
                              placeholder: tile[:label],
                              style: "width: 100%; background: rgba(255, 255, 255, 0.15) !important; color: #ffffff !important; border: 2px solid rgba(255, 255, 255, 0.3) !important; border-radius: 6px; padding: 0.75rem; font-size: 1rem; font-weight: 700;",
                              class: "form-control"
                            %>
                          </td>
                          
                          <!-- Categorie / Parent Menu -->
                          <td style="padding: 1.25rem 1rem; border-right: 2px solid rgba(255, 255, 255, 0.1);">
                            <%= select_tag "#{field_prefix}[parent_menu]",
                              options_for_select([
                                ['Training üèÉ‚Äç‚ôÇÔ∏è', 'menu_training'],
                                ['Beheer ‚öôÔ∏è', 'menu_beheer'],
                                ['Trainers üßë‚Äçüè´', 'menu_trainers'],
                                ['Admin üõ†Ô∏è', 'menu_admin'],
                                ['Geen dropdown', '']
                              ], assignment&.parent_menu || "menu_#{group_name.downcase}"),
                              class: 'form-control',
                              style: 'background: rgba(255, 255, 255, 0.15) !important; color: #ffffff !important; border: 2px solid rgba(255, 255, 255, 0.3) !important; border-radius: 6px; padding: 0.75rem; font-weight: 600;'
                            %>
                          </td>
                          
                          <!-- Positie -->
                          <td style="padding: 1.25rem 1rem;">
                            <%= number_field_tag "#{field_prefix}[position]", 
                              assignment&.position || (tile_index * 10),
                              style: "width: 90px; background: rgba(255, 255, 255, 0.15) !important; color: #ffffff !important; border: 2px solid rgba(255, 255, 255, 0.3) !important; border-radius: 6px; padding: 0.75rem; text-align: center; font-weight: 700; font-size: 1rem;",
                              class: "form-control"
                            %>
                          </td>
                        </tr>
                        
                        <!-- Hidden fields -->
                        <%= hidden_field_tag "#{field_prefix}[visible]", "1" %>
                        <%= hidden_field_tag "#{field_prefix}[custom_label]", tile[:label] %>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        <% end %>
        
        <!-- Opslaan Button -->
        <div class="row">
          <div class="col-12">
            <div style="background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 12px; text-align: center;">
              <%= f.submit "üíæ Opslaan voor #{role == 'user' ? 'Gebruikers' : role == 'trainer' ? 'Trainers' : 'Admins'}", 
                class: 'btn btn-lg',
                style: 'background: linear-gradient(135deg, #FC4C02 0%, #FF6B35 100%); color: white; border: none; font-weight: 700; padding: 1rem 3rem; font-size: 1.2rem; box-shadow: 0 4px 15px rgba(252, 76, 2, 0.3);',
                data: { confirm: "Weet je zeker dat je de menu instellingen wilt opslaan voor rol '#{role}'?" }
              %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<style>
  .form-control:focus {
    background: rgba(0, 0, 0, 0.4) !important;
    border-color: #1ee3cf !important;
    color: #f4f8ff !important;
    box-shadow: 0 0 0 0.2rem rgba(30, 227, 207, 0.25) !important;
  }
  
  .role-tab-button:hover {
    background: rgba(252, 76, 2, 0.1) !important;
    color: #FC4C02 !important;
  }
  
  .menu-checkbox:checked {
    background-color: #FC4C02;
  }
</style>

<script>
function showRoleTab(role) {
  // Verberg alle tabs
  document.querySelectorAll('.role-tab-content').forEach(content => {
    content.style.display = 'none';
  });
  
  // Reset alle tab buttons
  document.querySelectorAll('.role-tab-button').forEach(button => {
    button.style.background = 'transparent';
    button.style.borderBottom = '3px solid transparent';
    button.style.color = 'rgba(244, 248, 255, 0.6)';
  });
  
  // Toon geselecteerde tab
  document.getElementById('content-' + role).style.display = 'block';
  
  // Highlight geselecteerde button
  const selectedButton = document.getElementById('tab-' + role);
  selectedButton.style.background = 'rgba(252, 76, 2, 0.2)';
  selectedButton.style.borderBottom = '3px solid #FC4C02';
  selectedButton.style.color = '#FC4C02';
}
</script>
